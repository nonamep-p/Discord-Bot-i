# Epic RPG Helper - Discord Bot

## Overview

This is a comprehensive Discord bot that combines Epic RPG gameplay, economy systems, moderation tools, and AI-powered conversation features. The bot is built with Python using discord.py and designed to run on Replit with persistent data storage.

## User Preferences

Preferred communication style: Simple, everyday language.

## Recent Changes (January 2025)

### Advanced RNG System with Hidden Conditions
- **Date**: January 12, 2025
- **Added**: Comprehensive Random Number Generator system with luck mechanics
- **Features**: 
  - Dynamic luck multipliers based on hidden conditions
  - Rare event detection with extremely low probabilities
  - Time-based conditions (midnight blessing, prime time hours)
  - User-specific conditions (lucky numbers based on user ID)
  - Celestial events (full moon blessing)
  - Lucky streaks that build over time
  - Rare event rewards including legendary items and permanent stat boosts
- **Commands**: 
  - `$luck` - Check luck status and discover hidden conditions
  - Enhanced `$adventure` - Now includes luck-based outcomes and rare events
- **Hidden Mechanics**: Some conditions activate secretly based on time, user patterns, and random events

## System Architecture

### Core Architecture
- **Framework**: Python-based Discord bot using discord.py library
- **Hosting**: Replit platform with Flask-based keep-alive mechanism
- **Database**: Replit DB (key-value store) for persistent data storage
- **Architecture Pattern**: Cog-based modular design for feature separation
- **AI Integration**: Google Gemini API for conversational AI capabilities

### Bot Structure
- **Main Bot Class**: Custom bot class extending `commands.Bot`
- **Command Prefix**: Configurable per server (default: `$`)
- **Intents**: Full permissions for message content, members, guilds, and voice states
- **Cog System**: Modular feature separation across different functional areas

## Key Components

### 1. Keep-Alive System (`keep_alive.py`)
- **Purpose**: Maintains bot uptime on Replit's hosting platform
- **Implementation**: Flask web server with health check endpoints
- **Endpoints**: `/`, `/health`, `/status` with system monitoring
- **Threading**: Runs in separate daemon thread to avoid blocking main bot

### 2. AI Chatbot System (`cogs/ai_chatbot.py`)
- **Conversational AI**: Google Gemini-powered intelligent conversations
- **Context Management**: Maintains conversation history per guild/channel
- **Mention Detection**: Responds to mentions and message replies
- **Configuration**: Per-channel AI enable/disable controls
- **Timeout System**: Automatic conversation cleanup after inactivity

### 3. Interactive RPG System (`cogs/rpg_games.py`)
- **Character System**: Level-based progression with stats (HP, Attack, Defense)
- **Adventure System**: Random encounters with combat and exploration
- **Dungeon System**: Multi-floor challenges with escalating difficulty
- **Equipment System**: Weapons and armor with stat modifications
- **Interactive UI**: Discord buttons and embeds for navigation

### 4. Economy System (`cogs/economy.py`)
- **Work System**: Multiple job types with level-based bonuses
- **Daily Rewards**: Level-scaled daily coin bonuses
- **Shop System**: Item purchasing with dynamic pricing
- **Inventory Management**: Item storage and usage tracking
- **Cooldown System**: Time-based restrictions on economic activities

### 5. Moderation System (`cogs/moderation.py`)
- **Comprehensive Actions**: Kick, ban, mute, clear with permission validation
- **Role Hierarchy**: Intelligent role-based permission checks
- **Logging**: Detailed action logging with user notifications
- **Temporary Actions**: Timed mutes with automatic cleanup

### 6. Admin System (`cogs/admin.py`)
- **Module Management**: Enable/disable bot features per server
- **Configuration**: Server-specific settings and customization
- **System Monitoring**: Bot performance and database statistics
- **Channel Management**: AI channel configuration and permissions

## Data Flow

### User Data Management
1. **Registration**: Users start with `$start` command to create profile
2. **Profile Storage**: All user data stored in Replit DB with user ID as key
3. **Data Structure**: Hierarchical data with RPG stats, economy info, and settings
4. **Persistence**: Automatic data saving after each interaction

### Server Configuration
1. **Default Settings**: New servers get default configuration
2. **Module Control**: Individual feature enable/disable per server
3. **Channel Management**: AI and command channel restrictions
4. **Prefix Customization**: Server-specific command prefixes

### AI Conversation Flow
1. **Message Detection**: Bot monitors mentions and replies
2. **Context Building**: Maintains conversation history
3. **API Integration**: Sends context to Google Gemini
4. **Response Processing**: Formats and sends AI responses
5. **Cleanup**: Automatic conversation timeout and cleanup

## External Dependencies

### Core Dependencies
- **discord.py**: Main Discord API wrapper
- **Flask**: Web server for keep-alive functionality
- **psutil**: System monitoring and performance metrics
- **google-generativeai**: Google Gemini API integration
- **asyncio**: Asynchronous operation handling

### Database
- **Replit DB**: Built-in key-value store for data persistence
- **Structure**: JSON-like nested data storage
- **Backup**: Built-in Replit backup mechanisms

### APIs
- **Discord API**: Bot functionality and user interaction
- **Google Gemini API**: AI conversation capabilities
- **Replit Infrastructure**: Hosting and database services

## Deployment Strategy

### Replit Configuration
- **Main Entry Point**: `main.py` with automatic restart capability
- **Keep-Alive**: Flask server prevents Replit from sleeping
- **Environment Variables**: Secure token and API key storage
- **Automatic Deployment**: Git-based deployment with instant updates

### Error Handling
- **Graceful Failures**: Comprehensive try-catch blocks
- **Logging**: Detailed error logging with timestamps
- **Fallback Systems**: Degraded functionality when APIs unavailable
- **Recovery**: Automatic restart capabilities

### Scalability Considerations
- **Modular Design**: Easy to add/remove features
- **Database Efficiency**: Optimized data queries and storage
- **Memory Management**: Conversation history cleanup
- **Rate Limiting**: Built-in cooldown systems to prevent abuse

### Security
- **Permission Validation**: Role-based access control
- **Input Sanitization**: Safe handling of user inputs
- **Token Security**: Environment variable protection
- **Rate Limiting**: Cooldown systems prevent spam and abuse